# Task 1: Metrics from CSV - Phishing Detection Classification

id: "offline.task1.metrics_csv"
name: "Task 1 â€” Metrics from CSV"
category: "offline"
capability_profile:
  web: "forbidden"
  json_required: true
  retries: 1

prompt:
  system: |
    You are an enterprise assistant. Follow instructions exactly. Do not browse the web.
    Do not fabricate sources. Respond only in valid JSON format.
  user: |
    Analyze the following CSV data and calculate classification metrics for phishing detection.

    CSV Data:
    email_id,sender,subject,body_length,has_links,has_attachments,urgency_words,is_phishing
    1,support@bank.com,Account Verification Required,245,1,0,3,1
    2,newsletter@company.com,Weekly Updates,156,2,0,0,0
    3,urgent@security.com,IMMEDIATE ACTION REQUIRED,89,1,1,5,1
    4,info@vendor.com,Invoice #12345,134,0,1,0,0
    5,admin@internal.com,Policy Update,198,1,0,1,0
    6,noreply@service.com,Password Reset,67,1,0,2,1
    7,team@project.com,Meeting Notes,289,0,0,0,0
    8,alert@system.com,System Maintenance,145,1,0,1,0

    The last column 'is_phishing' indicates the ground truth (1=phishing, 0=legitimate).

    Calculate the following classification metrics and return them in JSON format:
    - precision (4 decimal places)
    - recall (4 decimal places)
    - f1 (4 decimal places)
    - accuracy (4 decimal places)
    - confusion_matrix with tp, fp, fn, tn (integers)

    Required JSON format:
    {
      "task1_data_metrics": {
        "precision": 0.0000,
        "recall": 0.0000,
        "f1": 0.0000,
        "accuracy": 0.0000,
        "confusion_matrix": {
          "tp": 0,
          "fp": 0,
          "fn": 0,
          "tn": 0
        }
      }
    }

expectation:
  schema_name: "task1_metrics"
  fields:
    - path: "$.task1_data_metrics.precision"
      type: "number"
    - path: "$.task1_data_metrics.recall"
      type: "number"
    - path: "$.task1_data_metrics.f1"
      type: "number"
    - path: "$.task1_data_metrics.accuracy"
      type: "number"
    - path: "$.task1_data_metrics.confusion_matrix.tp"
      type: "integer"
    - path: "$.task1_data_metrics.confusion_matrix.fp"
      type: "integer"
    - path: "$.task1_data_metrics.confusion_matrix.fn"
      type: "integer"
    - path: "$.task1_data_metrics.confusion_matrix.tn"
      type: "integer"

scoring:
  evaluator: "metrics_csv"
  config:
    tolerance: 0.0005
    round_to: 4
    weights:
      precision: 6
      recall: 6
      f1: 6
      accuracy: 6
      confusion_matrix:
        tp: 3
        fp: 3
        fn: 3
        tn: 3

fixtures:
  - path: "fixtures/csv/phishing_sample.csv"
    variable: "csv_content"

answer_key: "answer_keys/offline/task1_metrics.json"
